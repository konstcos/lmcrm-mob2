<!--
  Generated template for the OpenDetail page.

  See http://ionicframework.com/docs/v2/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>


    <ion-navbar color="primary">

        <!--<ion-buttons right>-->
        <!--<button ion-button clear (click)="close()">-->
        <!--<ion-icon name="md-arrow-forward"></ion-icon>-->
        <!--</button>-->
        <!--</ion-buttons>-->

        <!--<ion-title>OpenDetail</ion-title>-->


        <ion-buttons left text-center>
            <button ion-button (click)="close()">
                <ion-icon name="ios-arrow-back" class="back_arrow"></ion-icon>
            </button>
        </ion-buttons>

        <ion-title>{{ 'exposed_detail.title' | translate }}</ion-title>

        <ion-buttons right text-center>
            <button ion-button (click)="openLeadOrganizer()">
                <!--Organizer &nbsp;-->
                <ion-icon name="md-alarm"></ion-icon>
            </button>
        </ion-buttons>

    </ion-navbar>

</ion-header>


<ion-content padding>

    <!-- спинер загрузки -->
    <div *ngIf="sections.loading" class="spinnerLoading">
        <ion-spinner color="primary" name="crescent"></ion-spinner>
    </div>

    <!-- блок с данными -->
    <div *ngIf="sections.data">

        <!-- имя клиента -->
        <div class="data_block_header">
            <ion-row align-items-center>
                <ion-col class="copy_button" col-2 text-center (click)="copyNameToClipboard()">
                    <ion-icon name="copy"></ion-icon>
                </ion-col>
                <ion-col text-right class="name"> {{ item.lead.name }} {{ item.lead.surname }}</ion-col>
            </ion-row>
        </div>

        <!-- телефон клиента -->
        <div class="data_block">

            <ion-row align-items-center class="data_block_item">
                <ion-col class="copy_button" col-1 text-center (click)="copyPhoneToClipboard()">
                    <ion-icon name="copy"></ion-icon>
                </ion-col>
                <ion-col text-right (click)="makeCall(item)">
                    <div class="label">{{ 'exposed_detail.phone' | translate }}</div>
                    <div class="value">{{ item.lead.phone.phone }}</div>
                </ion-col>
                <ion-col col-1 text-right (click)="makeCall(item)">
                    <ion-icon class="color_green icon_param" name="ios-call"></ion-icon>
                </ion-col>
            </ion-row>

        </div>

        <!-- блок с кнопкой передачи по адвертайзингу -->
        <div *ngIf="item.advertising" class="">

            <ion-row align-items-center>
                <ion-col text-center>

                    <button ion-button round icon-left small color="light" (click)="auctionConfirmation()">
                        <ion-icon name="md-person-add"></ion-icon>
                        {{ 'exposed_detail.send_to_auction.button_title' | translate }}
                    </button>

                </ion-col>
            </ion-row>

        </div>

        <!-- блок со статусами -->
        <div class="status_block">
            <!--<ion-row>-->
            <!--<ion-col>-->
            <!--<button ion-button small full (click)="changeStatus(item)">-->
            <!--{{ item.status_info ? item.status_info.stepname : ('exposed_detail.no_status' | translate) }}-->
            <!--</button>-->
            <!--</ion-col>-->
            <!--</ion-row>-->


            <ion-row>
                <ion-col>

                    <div *ngIf="roles.subRole == 'leadbayer'">

                        <div *ngIf="item.close_deal_info">

                            <div class="deal_is_closed">

                                <div class="name">{{ 'exposed.deal_is_closed' | translate }}</div>

                                <ion-row class="deal_data_row">

                                    <ion-col>
                                        <div class="deal_data_title">{{ 'exposed.deal_name' | translate }}</div>
                                        <div class="deal_data_data">{{ item.status_info.stepname }}</div>
                                    </ion-col>

                                    <ion-col>
                                        <div class="deal_data_title">{{ 'exposed.deal_price' | translate }}</div>
                                        <div class="deal_data_data"><b>&#8362;</b> {{ item.close_deal_info.price }}
                                        </div>
                                    </ion-col>

                                </ion-row>


                            </div>

                        </div>

                        <div *ngIf="!item.close_deal_info">
                            <!--<button ion-button small full (click)="changeStatus(item)">-->
                            <!--{{ item.status_info ? item.status_info.stepname : ('exposed_detail.no_status' | translate) }}-->
                            <!--</button>-->

                            <div *ngIf="item.status_info && item.status_info.type == 4" class="open_lead_bad_status">
                                {{ item.status_info.stepname }}
                            </div>

                            <div *ngIf="!item.status_info || item.status_info.type != 4">
                                <button ion-button small full (click)="changeStatus(item)">
                                    {{ item.status_info ? item.status_info.stepname : ('exposed.no_status' | translate)
                                    }}
                                </button>
                            </div>

                        </div>

                    </div>

                    <div *ngIf="roles.subRole == 'dealmaker'">
                        <!--<button ion-button small full (click)="changeStatus(item)">-->
                        <!--{{ item.status_info ? item.status_info.stepname : ('exposed_detail.no_status' | translate) }}-->
                        <!--</button>-->

                        <div *ngIf="item.status_info && item.status_info.type == 4" class="open_lead_bad_status">
                            {{ item.status_info.stepname }}
                        </div>

                        <div *ngIf="!item.status_info || item.status_info.type != 4">
                            <button ion-button small full (click)="changeStatus(item)">
                                {{ item.status_info ? item.status_info.stepname : ('exposed.no_status' | translate) }}
                            </button>
                        </div>

                    </div>

                </ion-col>

            </ion-row>

        </div>

        <!-- блок с голосовыми записями -->
        <div class="voice_block" *ngIf="item.voice">

            <ion-row align-items-center class="data_block_item">


                <ion-col text-center>

                    <div *ngFor="let voice of item.voice" text-center class="voice_item_side">
                        <audio controls>
                            <source src="{{ voice.url }}" type="audio/mpeg">
                        </audio>
                    </div>

                </ion-col>


            </ion-row>

        </div>

        <!-- сфера и имя маски -->
        <div class="data_block">

            <ion-row align-items-center class="data_block_item">
                <!--<ion-col col-1 text-left><ion-icon ios="ios-eye" md="md-eye"></ion-icon></ion-col>-->
                <ion-col text-right>
                    <div class="label">{{ 'exposed_detail.sphere' | translate }}</div>
                    <div class="value">{{ item.lead.sphere.name }}</div>
                </ion-col>
                <ion-col col-1 text-right>
                    <ion-icon class="icon_param sphere_color" name="ios-cloud"></ion-icon>
                </ion-col>
            </ion-row>

            <ion-row align-items-center class="data_block_item">
                <!--<ion-col col-1 text-left><ion-icon ios="ios-eye" md="md-eye"></ion-icon></ion-col>-->
                <ion-col text-right>
                    <div class="label">{{ 'exposed_detail.mask_name' | translate }}</div>
                    <div class="value">{{ item.mask_name2 ? item.mask_name2.name : ('exposed_detail.deleted' |
                        translate) }}
                    </div>
                </ion-col>
                <ion-col col-1 text-right>
                    <ion-icon class="icon_param mask_color" name="ios-funnel"></ion-icon>
                </ion-col>
            </ion-row>

        </div>

        <!-- блок с датой и именем открывшего лид-->
        <div class="data_block">

            <ion-row align-items-center class="data_block_item">
                <!--<ion-col col-1 text-left><ion-icon class="help_icon" name="md-help-circle"></ion-icon></ion-col>-->
                <ion-col text-right>
                    <div class="label">{{ 'exposed_detail.opened' | translate }}</div>
                    <div class="value">
                        <span class="date_time">{{ item.date.time }}</span>
                        <span class="date_date">{{ item.date.date }}</span>
                    </div>
                </ion-col>
                <ion-col col-1 text-right>
                    <ion-icon class="icon_param calendar_color" name="md-calendar"></ion-icon>
                </ion-col>
            </ion-row>

            <!--<ion-row align-items-center class="data_block_item">-->
                <!--&lt;!&ndash;<ion-col col-1 text-left><ion-icon class="help_icon" name="md-help-circle"></ion-icon></ion-col>&ndash;&gt;-->
                <!--<ion-col text-right>-->
                    <!--<div class="label">{{ 'exposed_detail.opened_by' | translate }}</div>-->
                    <!--<div class="value">{{ 'exposed_detail.you' | translate }}-->
                        <!--&lt;!&ndash;<span class="date_time">{{ item.auction_added.time }}</span>&ndash;&gt;-->
                        <!--&lt;!&ndash;<span class="date_date">{{ item.auction_added.date }}</span>&ndash;&gt;-->
                    <!--</div>-->
                <!--</ion-col>-->
                <!--<ion-col col-1 text-right>-->
                    <!--<ion-icon class="icon_param calendar_color" name="md-calendar"></ion-icon>-->
                <!--</ion-col>-->
            <!--</ion-row>-->

        </div>

        <!-- дополнительные данные и данные фильтра -->
        <div class="data_block">

            <div *ngFor="let additional of item.lead.additional">
                <!--<ion-row align-items-center *ngIf="additional.value && additional.value.trim().length > 0 && additional.value.trim() != '00-00-0000' && additional.value.trim() != '0000-00-00'" class="data_block_item">-->
                <ion-row align-items-center class="data_block_item">
                    <!--<ion-col col-1 text-left><ion-icon ios="ios-eye" md="md-eye"></ion-icon></ion-col>-->
                    <ion-col text-right>
                        <div class="label">{{ additional.label }}</div>
                        <!--<div class="value">{{ additional.value ? additional.value : '-&#45;&#45; no data &#45;&#45;&#45;&#45;' }}</div>-->
                        <div class="value" *ngIf="additional.value && additional.value.trim().length > 0 && additional.value.trim() != '00-00-0000' && additional.value.trim() != '0000-00-00'">{{ additional.value }}</div>
                        <div class="value" *ngIf="!additional.value || additional.value.trim().length <= 0 || additional.value.trim() == '00-00-0000' || additional.value.trim() == '0000-00-00'">{{ 'no_additional_data_for_lead' | translate }}</div>
                    </ion-col>
                    <ion-col col-1 text-right>
                        <ion-icon class="icon_param doc_color" name="ios-paper"></ion-icon>
                    </ion-col>
                </ion-row>
            </div>

            <div *ngFor="let filter of item.lead.filter">
                <!--<ion-row align-items-center *ngIf="filter.value && filter.value.trim().length > 0 && filter.value.trim() != '00-00-0000' && filter.value.trim() != '0000-00-00'" class="data_block_item">-->
                <ion-row align-items-center class="data_block_item">
                    <ion-col text-right>
                        <div class="label">{{ filter.label }}</div>
                        <!--<div class="value">{{ filter.value ? filter.value : '&nbsp;' }}</div>-->
                        <div class="value" *ngIf="filter.value && filter.value.trim().length > 0 && filter.value.trim() != '00-00-0000' && filter.value.trim() != '0000-00-00'">{{ filter.value }}</div>
                        <div class="value" *ngIf="!filter.value || filter.value.trim().length <= 0 || filter.value.trim() == '00-00-0000' || filter.value.trim() == '0000-00-00'">{{ 'no_additional_data_for_lead' | translate }}</div>

                    </ion-col>
                    <ion-col col-1 text-right>
                        <ion-icon class="icon_param doc_color" name="ios-paper"></ion-icon>
                    </ion-col>
                </ion-row>
            </div>

        </div>


        <!-- регион -->
        <div class="data_block">

            <ion-row align-items-center *ngIf="item.region && item.region.trim().length > 0" class="data_block_item">
                <!--<ion-col col-1 text-left><ion-icon ios="ios-eye" md="md-eye"></ion-icon></ion-col>-->
                <ion-col text-right>
                    <div class="label">{{ 'incoming_detail.region' | translate }}</div>
                    <div class="value">{{ item.region }}</div>
                </ion-col>
                <ion-col col-1 text-right>
                    <ion-icon class="icon_param doc_color" name="ios-paper"></ion-icon>
                </ion-col>
            </ion-row>

        </div>

        <!-- Комментарий -->
        <!--<div class="data_block" *ngIf="item.lead.comment && item.lead.comment.trim().length > 0">-->
        <div class="data_block">

            <ion-row align-items-center class="data_block_item">
                <!--<ion-col col-1 text-left><ion-icon ios="ios-eye" md="md-eye"></ion-icon></ion-col>-->
                <ion-col text-right>
                    <div class="label">{{ 'exposed_detail.comment' | translate }}</div>

                    <div class="value" *ngIf="item.lead.comment && item.lead.comment.trim().length > 0">{{ item.lead.comment }}</div>
                    <div class="value" *ngIf="!item.lead.comment || item.lead.comment.trim().length <= 0">{{ 'no_additional_data_for_lead' | translate }}</div>

                </ion-col>
                <ion-col col-1 text-right>
                    <ion-icon class="icon_param doc_color" name="ios-paper"></ion-icon>
                </ion-col>
            </ion-row>

        </div>

    </div>



    <!-- блок с ошибкой -->
    <div *ngIf="sections.error" class="error_area">

        <div class="error_text">
            {{ 'incoming_detail.open_lead_area.incomprehensibleError' | translate }}
        </div>

        <div class="error_button">
            <button ion-button large color="light" (click)="refresh()">
                <ion-icon name="md-refresh"></ion-icon>
            </button>
        </div>

    </div>

    <!-- подтверждение отправки лида на аукцион -->
    <div *ngIf="sections.auction" class="auction_block">

        <div class="auction_data">
            {{ 'exposed_detail.send_to_auction.text' | translate }}
            <!--The Lead will be sent for auction.-->
            <!--It disappears from the Exposed section and appears in the Outgoing section.-->
            <!--As with other introduced Leads, you will be able to profit from this Leads.-->
        </div>

        <div class="auction_buttons_block">

            <div text-center class="auction_button_send">
                <button ion-button small round color="secondary" (click)="sendToAuction()">
                    {{ 'exposed_detail.send_to_auction.apply_button' | translate }}
                </button>
            </div>


            <div text-center class="auction_button_cancel">
                <button ion-button small round (click)="auctionCanceled()" color="danger">
                    {{ 'exposed_detail.send_to_auction.cancel_button' | translate }}
                    <!--cancel-->
                </button>
            </div>

        </div>

    </div>

</ion-content>
